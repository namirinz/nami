# -*- coding: utf-8 -*-
"""nami_API.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1nbrcmBFb-fr6CR-r0kgLudwPAd1TdsvB
"""

import json
import requests
from bs4 import BeautifulSoup

page = requests.get("http://image-net.org/archive/words.txt")
soup = BeautifulSoup(page.content, 'html.parser')

str_soup = str(soup)
split_urls = str_soup.split('\n')

dict_noun = {}

def is_avaliable(noun_id):
  url = "http://www.image-net.org/api/text/imagenet.synset.geturls?wnid="+str(noun_id)
  with requests.Session() as r:
    page = r.get(url)
    if str(page.content)[2] == 'T':
      return False
    return True

length = len(split_urls)

def get_synset():
  for i in range(length):
    keys = split_urls[i].split('\t')[1].split(',')
    value = split_urls[i].split('\t')[0]
    if is_avaliable(value):
      for key in keys:
        key = key.strip()
        if key not in dict_noun:
          dict_noun[key] = [value]
        else :
          dict_noun[key].append(value)
    if i%5000 == 0: 
      print(i,'from',length)

get_synset()

with open('synset.json', 'w') as file:
  json.dump(dict_noun, file)

'''
code to notify when code is running sucessfully to line.

pip install line_notify

def line_message(message):
  payload = {'message': message}
  return line_send(payload)

def line_sticker(sticker_id, sticker_package_id):
  payload = {'message': ' ', 'stickerPackageId': sticker_package_id, 'stickerId': sticker_id}
  return line_send(payload)

def line_send(payload):
  url = 'https://notify-api.line.me/api/notify'
  token = 'hRkUVXRyCSkarLWv4Cqs78v6HnNpKl73FUxUlpWIMIJ'
  headers = {'Authorization': 'Bearer '+token}
  return requests.post(url, headers=headers, data=payload)

line_message("nami_API from google colab run successfuly")
line_sticker(11, 1)

'''
